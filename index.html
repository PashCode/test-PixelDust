<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            /*min-height: 100vh;*/
            background: #f0f0f0;
            margin: 0;
            overflow: hidden;
        }
        .shatter-container {
            position: relative;
            width: 250px;
            height: 250px;
            background: url('hidden-card.jpg') no-repeat center/cover;
            cursor: pointer;
            will-change: transform, opacity; /* Подготовка элементов для анимации */
        }
        .shatter-piece {
            position: absolute;
            background-size: 250px 250px;
            transition: transform 0.3s, opacity 0.3s; /* Ограничиваем анимацию только этими свойствами */
            will-change: transform, opacity; /* Подготовка для оптимизации */
        }
    </style>
</head>
<body>
<div class="shatter-container"></div>

<script>
    const container = document.querySelector('.shatter-container');
    const cols = 8;
    const rows = 8;
    const width = 250;
    const height = 250;

    let isShattered = false;
    let pieces = [];

    function createShatterPieces() {
        container.innerHTML = ''; // Очистка контейнера перед созданием карточек
        pieces = [];

        for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
                const piece = document.createElement('div');
                piece.classList.add('shatter-piece');

                piece.style.width = `${width / cols}px`;
                piece.style.height = `${height / rows}px`;
                piece.style.backgroundImage = `url('hidden-card.jpg')`;
                piece.style.backgroundPosition = `-${col * (width / cols)}px -${row * (height / rows)}px`;

                piece.style.left = `${col * (width / cols)}px`;
                piece.style.top = `${row * (height / rows)}px`;

                // Сохраняем начальные позиции для анимации сборки
                pieces.push({
                    element: piece,
                    originalLeft: piece.style.left,
                    originalTop: piece.style.top
                });

                container.appendChild(piece);
            }
        }
    }

    function shatterPieces() {
        container.style.background = 'none'; // Убираем фон
        const centerX = width / 2;
        const centerY = height / 2;

        pieces.forEach((piece) => {
            const pieceX = parseInt(piece.originalLeft);
            const pieceY = parseInt(piece.originalTop);

            const angle = Math.atan2(pieceY - centerY, pieceX - centerX);
            const distance = Math.random() * 50 + 100;

            const translateX = Math.cos(angle) * distance;
            const translateY = Math.sin(angle) * distance;

            piece.element.style.transform = `translate(${translateX}px, ${translateY}px)`;
            piece.element.style.opacity = '0';
        });
    }

    function assemblePieces() {
        pieces.forEach((piece) => {
            piece.element.style.transform = 'translate(0, 0)';
            piece.element.style.opacity = '1';
        });

        // Восстанавливаем фон после анимации
        setTimeout(() => {
            container.style.background = `url('hidden-card.jpg') no-repeat center/cover`;
        }, 300);
    }

    // Создаем карточки при загрузке
    createShatterPieces();

    container.addEventListener('click', () => {
        if (!isShattered) {
            shatterPieces();
        } else {
            assemblePieces();
        }
        isShattered = !isShattered;
    });
</script>
</body>
</html>